
# "Reset the environment"
rm -rf .venv

# "Install all packages into the virtual environment (and all of their dependencies)"
# "Both will succeed because _all_ dependencies are installed into the same 1 virtual environment."
uv sync --all-packages
Using CPython 3.12.10
Creating virtual environment at: .venv
Resolved 19 packages in 0.72ms
Installed 16 packages in 58ms
 + contourpy==1.3.2
 + cycler==0.12.1
 + fonttools==4.58.0
 + kiwisolver==1.4.8
 + matplotlib==3.10.3
 + mypy==1.15.0
 + mypy-extensions==1.1.0
 + numpy==2.2.6
 + packaging==25.0
 + pillow==11.2.1
 + pyparsing==3.2.3
 + python-dateutil==2.9.0.post0
 + ruff==0.11.11
 + six==1.17.0
 + structlog==25.3.0
 + typing-extensions==4.13.2

uv run mypy app
Success: no issues found in 2 source files

uv run mypy lib
Success: no issues found in 2 source files

# "Install just the root package into the virtual environment"
# "Both will fail because they uses dependencies that aren't in the root package"
uv sync
Resolved 19 packages in 0.76ms
Uninstalled 12 packages in 102ms
 - contourpy==1.3.2
 - cycler==0.12.1
 - fonttools==4.58.0
 - kiwisolver==1.4.8
 - matplotlib==3.10.3
 - numpy==2.2.6
 - packaging==25.0
 - pillow==11.2.1
 - pyparsing==3.2.3
 - python-dateutil==2.9.0.post0
 - six==1.17.0
 - structlog==25.3.0

uv run mypy app
app/src/app/main.py:1: error: Cannot find implementation or library stub for module named "matplotlib"  [import-not-found]
app/src/app/main.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 2 source files)

uv run mypy lib
lib/src/lib/lib.py:1: error: Cannot find implementation or library stub for module named "structlog"  [import-not-found]
lib/src/lib/lib.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 2 source files)


# "Install the `app` package into the virtual environment"
# "`lib` will succeed because it uses a leaked dependency from `app`"
uv sync --package app
Resolved 19 packages in 0.86ms
Uninstalled 1 package in 0.66ms
Installed 1 package in 1ms
 - ruff==0.11.11
 + structlog==25.3.0

uv run mypy app
Installed 1 package in 2ms
app/src/app/main.py:1: error: Cannot find implementation or library stub for module named "matplotlib"  [import-not-found]
app/src/app/main.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 2 source files)

uv run mypy lib
Success: no issues found in 2 source files

# "Install the `lib` package into the virtual environment."
# "`app` will succeed because it uses a leaked dependency from `lib`"
uv sync --package lib
Resolved 19 packages in 0.78ms
Uninstalled 2 packages in 1ms
Installed 11 packages in 17ms
 + contourpy==1.3.2
 + cycler==0.12.1
 + fonttools==4.58.0
 + kiwisolver==1.4.8
 + matplotlib==3.10.3
 + numpy==2.2.6
 + packaging==25.0
 + pillow==11.2.1
 + pyparsing==3.2.3
 + python-dateutil==2.9.0.post0
 - ruff==0.11.11
 + six==1.17.0
 - structlog==25.3.0

uv run mypy app
Installed 1 package in 2ms
Success: no issues found in 2 source files

uv run mypy lib
lib/src/lib/lib.py:1: error: Cannot find implementation or library stub for module named "structlog"  [import-not-found]
lib/src/lib/lib.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 2 source files)


# "Reset the environment and run mypy from the packages environment"
# "The paths are still relative to the root"
# "Running mypy in the app package will fail, but after running the lib package, running mypy in the app package will succeed"
uv sync
Resolved 19 packages in 0.81ms
Uninstalled 11 packages in 100ms
 - contourpy==1.3.2
 - cycler==0.12.1
 - fonttools==4.58.0
 - kiwisolver==1.4.8
 - matplotlib==3.10.3
 - numpy==2.2.6
 - packaging==25.0
 - pillow==11.2.1
 - pyparsing==3.2.3
 - python-dateutil==2.9.0.post0
 - six==1.17.0

uv run --package app mypy app
Installed 1 package in 1ms
app/src/app/main.py:1: error: Cannot find implementation or library stub for module named "matplotlib"  [import-not-found]
app/src/app/main.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 2 source files)

uv run --package lib mypy lib
Installed 11 packages in 19ms
Success: no issues found in 2 source files

uv run --package app mypy app
Success: no issues found in 2 source files

# "Reset the environment and run mypy from the packages environment"
# "The paths are still relative to the root"
# "We reverse the order this time, and run mypy in the lib package first"
# "Running mypy in the lib package will fail, but after running the app package, running mypy in the lib package will succeed"
uv sync
Resolved 19 packages in 0.71ms
Uninstalled 12 packages in 101ms
 - contourpy==1.3.2
 - cycler==0.12.1
 - fonttools==4.58.0
 - kiwisolver==1.4.8
 - matplotlib==3.10.3
 - numpy==2.2.6
 - packaging==25.0
 - pillow==11.2.1
 - pyparsing==3.2.3
 - python-dateutil==2.9.0.post0
 - six==1.17.0
 - structlog==25.3.0

uv run --package lib mypy lib
Installed 11 packages in 17ms
lib/src/lib/lib.py:1: error: Cannot find implementation or library stub for module named "structlog"  [import-not-found]
lib/src/lib/lib.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 2 source files)

uv run --package app mypy app
Installed 1 package in 1ms
Success: no issues found in 2 source files

uv run --package lib mypy lib
Success: no issues found in 2 source files
