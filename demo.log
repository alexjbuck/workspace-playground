
# "Reset the environment"
rm -rf .venv

# "Install all packages into the virtual environment (and all of their dependencies)"
# "Both will succeed because _all_ dependencies are installed into the same 1 virtual environment."
uv sync --all-packages
Using CPython 3.12.10
Creating virtual environment at: .venv
Resolved 19 packages in 0.81ms
Installed 16 packages in 36ms
 + contourpy==1.3.2
 + cycler==0.12.1
 + fonttools==4.58.0
 + kiwisolver==1.4.8
 + matplotlib==3.10.3
 + mypy==1.15.0
 + mypy-extensions==1.1.0
 + numpy==2.2.6
 + packaging==25.0
 + pillow==11.2.1
 + pyparsing==3.2.3
 + python-dateutil==2.9.0.post0
 + ruff==0.11.11
 + six==1.17.0
 + structlog==25.3.0
 + typing-extensions==4.13.2

uv run mypy app
Success: no issues found in 1 source file

uv run mypy lib
Success: no issues found in 1 source file

# "Install just the root package into the virtual environment"
# "Both will fail because they uses dependencies that aren't in the root package"
uv sync
Resolved 19 packages in 0.94ms
Uninstalled 12 packages in 101ms
 - contourpy==1.3.2
 - cycler==0.12.1
 - fonttools==4.58.0
 - kiwisolver==1.4.8
 - matplotlib==3.10.3
 - numpy==2.2.6
 - packaging==25.0
 - pillow==11.2.1
 - pyparsing==3.2.3
 - python-dateutil==2.9.0.post0
 - six==1.17.0
 - structlog==25.3.0

uv run mypy app
app/main.py:1: error: Cannot find implementation or library stub for module named "matplotlib"  [import-not-found]
app/main.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 1 source file)

uv run mypy lib
lib/main.py:1: error: Cannot find implementation or library stub for module named "structlog"  [import-not-found]
lib/main.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 1 source file)


# "Install the `app` package into the virtual environment"
# "`lib` will succeed because it uses a leaked dependency from `app`"
uv sync --package app
Resolved 19 packages in 0.92ms
Uninstalled 1 package in 0.58ms
Installed 1 package in 1ms
 - ruff==0.11.11
 + structlog==25.3.0

uv run mypy app
Installed 1 package in 2ms
app/main.py:1: error: Cannot find implementation or library stub for module named "matplotlib"  [import-not-found]
app/main.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 1 source file)

uv run mypy lib
Success: no issues found in 1 source file

# "Install the `lib` package into the virtual environment."
# "`app` will succeed because it uses a leaked dependency from `lib`"
uv sync --package lib
Resolved 19 packages in 0.86ms
Uninstalled 2 packages in 1ms
Installed 11 packages in 16ms
 + contourpy==1.3.2
 + cycler==0.12.1
 + fonttools==4.58.0
 + kiwisolver==1.4.8
 + matplotlib==3.10.3
 + numpy==2.2.6
 + packaging==25.0
 + pillow==11.2.1
 + pyparsing==3.2.3
 + python-dateutil==2.9.0.post0
 - ruff==0.11.11
 + six==1.17.0
 - structlog==25.3.0

uv run mypy app
Installed 1 package in 2ms
Success: no issues found in 1 source file

uv run mypy lib
lib/main.py:1: error: Cannot find implementation or library stub for module named "structlog"  [import-not-found]
lib/main.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 1 source file)


# "Reset the environment and run mypy from the packages environment"
# "The paths are still relative to the root"
# "Running mypy in the app package will fail, but after running the lib package, running mypy in the app package will succeed"
uv sync
Resolved 19 packages in 0.85ms
Uninstalled 11 packages in 99ms
 - contourpy==1.3.2
 - cycler==0.12.1
 - fonttools==4.58.0
 - kiwisolver==1.4.8
 - matplotlib==3.10.3
 - numpy==2.2.6
 - packaging==25.0
 - pillow==11.2.1
 - pyparsing==3.2.3
 - python-dateutil==2.9.0.post0
 - six==1.17.0

uv run --package app mypy app
Installed 1 package in 1ms
app/main.py:1: error: Cannot find implementation or library stub for module named "matplotlib"  [import-not-found]
app/main.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 1 source file)

uv run --package lib mypy lib
Installed 11 packages in 20ms
Success: no issues found in 1 source file

uv run --package app mypy app
Success: no issues found in 1 source file

# "Reset the environment and run mypy from the packages environment"
# "The paths are still relative to the root"
# "We reverse the order this time, and run mypy in the lib package first"
# "Running mypy in the lib package will fail, but after running the app package, running mypy in the lib package will succeed"
uv sync
Resolved 19 packages in 0.96ms
Uninstalled 12 packages in 108ms
 - contourpy==1.3.2
 - cycler==0.12.1
 - fonttools==4.58.0
 - kiwisolver==1.4.8
 - matplotlib==3.10.3
 - numpy==2.2.6
 - packaging==25.0
 - pillow==11.2.1
 - pyparsing==3.2.3
 - python-dateutil==2.9.0.post0
 - six==1.17.0
 - structlog==25.3.0

uv run --package lib mypy lib
Installed 11 packages in 19ms
lib/main.py:1: error: Cannot find implementation or library stub for module named "structlog"  [import-not-found]
lib/main.py:1: note: See https://mypy.readthedocs.io/en/stable/running_mypy.html#missing-imports
Found 1 error in 1 file (checked 1 source file)

uv run --package app mypy app
Installed 1 package in 1ms
Success: no issues found in 1 source file

uv run --package lib mypy lib
Success: no issues found in 1 source file
